@using Entities;
@model Game
@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Game profile";
}
    <div class="background-image">
        <a href="#">
            @Html.Raw("<img class='background-img' src=\"data:image/jpeg;base64,"
      + @Model.BackgroundImage + "\" />")
        </a>
    </div>
<div class="gameprofile-container">
    <h1 class="gametitle">@Model.Name</h1>
    <div class="gameProfileItem">
        <div class="gameprofile-left">
            <div class="profileimage">
                <a href="#">
                   @Html.Raw("<img class='gamesimg' src=\"data:image/jpeg;base64,"+ @Model.ProfileImage + "\" />")
                </a>
            </div>
            <div class="gameprofiletextcontainer">
                <div class="gameprofiletext">
                    <div class="gamegenrekey">
                        <p>Жанр</p>
                        <p>Издатель</p>
                    </div>
                    <div class="gamegenrevalue">
                        <p>@Model.Category</p>
                        <p>@Model.Producer</p>
                    </div>
                </div>
                <div class="gamerating">
                    <p>Рейтинг: 12+</p>
                </div>
            </div>
        </div>
        <div class="gameprofile-right">
            <div class="gameitemcontainer">
                <div class="infocard">
                    <ul>
                        <li class="checkmark">Наличие: много</li>
                        <li class="key">Лицензионный ключ активации в Social Club</li>
                        <li class="letter">Моментальная доставка на e-mail</li>
                        <li class="procent">Накопительная скидка до 10%</li>
                    </ul>
                </div>
                <div class="shopcontainer">
                    <div class="price">@Model.Price.ToString("#.##") <span class="rub">руб.</span></div>
                    <div class="buttoncontainer">
                        @Html.ActionLink("Купить", "OrderForm", "Order", new { @id = Model.GameId }, new { @class = "buy" })
                     
                        <a href="#" id ="addtocart" data-gameId = "@Model.GameId" class="addtocart">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 width="31" height="20" viewBox="0 0 37.438 26.646">
                                <path fill="none" stroke="white" stroke-width="2"
                                      stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"
                                      d="M20.854 5.182h14.584l-6.105 11.959h-14.5L7.167.963H1">
                                </path>
                                <circle fill="none" stroke="white" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"
                                        cx="17.188" cy="23.682" r="2"></circle>
                                <circle fill="none" stroke="white"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                        stroke-miterlimit="10" cx="26.313" cy="23.682" r="2"></circle>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="gameprofile-right-item">
                <p class="blocktitle">Описание</p>
                <p>@Model.Description</p>
            </div>
            <div class="gameprofile-right-item">
                <p class="blocktitle">Минимальные системные требования</p>
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#panel1">Windows</a></li>
                    <li><a data-toggle="tab" href="#panel2">Mac</a></li>
                </ul>
                <div class="tab-content">
                    <div id="panel1" class="tab-pane fade in active">
                        <div class="tab-item">
                            <div class="tab-key">OC</div>
                            <div class="tab-value">64-bit Windows 7/8.1/10</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Процессор</div>
                            <div class="tab-value">
                                AMD FX-6100/Intel i3-3220 or Equivalent
                            </div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Оперативная память</div>
                            <div class="tab-value">8 GB ОЗУ</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Видеокарта</div>
                            <div class="tab-value">AMD Radeon HD 7750, NVIDIA GeForce GTX 650 or Equivalent</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">DirectX</div>
                            <div class="tab-value">Версии 11</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Жесткий диск</div>
                            <div class="tab-value">55 GB</div>
                        </div>
                    </div>
                    <div id="panel2" class="tab-pane fade">
                        <div class="tab-item">
                            <div class="tab-key">OC</div>
                            <div class="tab-value">64-bit Windows 7/8.1/10</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Процессор</div>
                            <div class="tab-value">
                                AMD FX-6100/Intel i3-3220 or Equivalent
                            </div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Оперативная память</div>
                            <div class="tab-value">8 GB ОЗУ</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Видеокарта</div>
                            <div class="tab-value">AMD Radeon HD 7750, NVIDIA GeForce GTX 650 or Equivalent</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">DirectX</div>
                            <div class="tab-value">Версии 11</div>
                        </div>
                        <div class="tab-item">
                            <div class="tab-key">Жесткий диск</div>
                            <div class="tab-value">55 GB</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="gameprofile-right-item">
                <div class="comment">
                    <p class="blocktitle">Комментарии</p>
                    @if (!User.Identity.IsAuthenticated)
                    {
                        <p class="out">Войти</p>
                    }
                </div>
                <form name="comment" action="#" method="post">
                    <p>
                        <textarea name="text_comment" cols="10" rows="20" class="massagesend" placeholder="Напишете ваш комментарий..."></textarea>
                    </p>
                    <p>
                        <input type="hidden" name="page_id" value="150" />
                        <a href="#" class="addcommentbutton">Опубликовать</a>
                    </p>
                </form>
                <div class="massagescontainer">
                    <div class="massagecontainer">
                        <div class="messagehead">
                            <p class="massagename">John Snow</p>
                            <p class="massagedate">вчера, в 22:26</p>
                        </div>
                        <p class="massagetext">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Fugiat assumenda adipisci, amet facilis doloribus quaerat voluptates officiis sapiente, animi quam, consequuntur odit delectus. Maxime, aliquam quis voluptatum mollitia repellendus explicabo? Lorem ipsum dolor sit amet consectetur adipisicing elit. Distinctio suscipit odio illum nisi dolore minus dolores sapiente sit? Fugiat atque reiciendis enim laborum ullam officia esse omnis molestias non mollitia!</p>
                    </div>
                    <div class="massagecontainer">
                        <p class="massagename">John Snow</p>
                        <p class="massagetext">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Fugiat assumenda adipisci, amet facilis doloribus quaerat voluptates officiis sapiente, animi quam, consequuntur odit delectus. Maxime, aliquam quis voluptatum mollitia repellendus explicabo? Lorem ipsum dolor sit amet consectetur adipisicing elit. Distinctio suscipit odio illum nisi dolore minus dolores sapiente sit? Fugiat atque reiciendis enim laborum ullam officia esse omnis molestias non mollitia!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    let buybutton = document.getElementById("addtocart");
    buybutton.addEventListener("click", () => {
        count++;
        ordercount.innerText = count;
        ordercount.classList.add('displayblock');
        let productID = buybutton.getAttribute("data-gameId");
        let item = {};
        if (getCookie("CartProducts")) {
            let arr = JSON.parse(getCookie("CartProducts"));
            if (arr.some(i => i.id === productID)) {
                arr.forEach(i => {
                    if (i.id === productID) {
                        i.count += 1;
                    }
                })
                setCookie("CartProducts", JSON.stringify(arr));
            } else {
                item = { id: productID, count: 1 };
                arr.push(item);
                setCookie("CartProducts", JSON.stringify(arr));
            }
        } else {
            item = { id: productID, count: 1 };
            setCookie("CartProducts", JSON.stringify([item]));
        }
        let arrID = [];
    });

    function getCookie(name) {
        let matches = document.cookie.match(new RegExp(
            "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ))
        return matches ? decodeURIComponent(matches[1]) : undefined
    }
    function setCookie(name, value, props) {
        props = props || {};
        let exp = props.expires;
        if (typeof exp == "number" && exp) {
            let d = new Date();
            d.setTime(d.getTime() + exp * 1000);
            exp = props.expires = d;
        }
        if(exp && exp.toUTCString) { props.expires = exp.toUTCString() }
        value = encodeURIComponent(value);
        let updatedCookie = name + "=" + value + ";path=/";

        for(let propName in props){
            updatedCookie += "; " + propName;
            let propValue = props[propName];
            if (propValue !== true) { updatedCookie += "=" + propValue };
        }
        document.cookie = updatedCookie;
    }
    function deleteCookie(name) {
        setCookie(name, null, { expires: -1 })
    }
</script>
